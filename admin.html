<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8"/>
<title>簽約儀式 - 管理 / 大螢幕</title>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<link rel="stylesheet" href="admin.css">
<script src="/socket.io/socket.io.js"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
</head>
<body>
<!-- 登入/註冊/忘記/重設 -->
<div id="authMask" hidden>
  <div id="authCard">
    <h2>登入系統</h2>
    <div class="field"><label>Email</label><input id="authEmail" type="email" placeholder="you@example.com" autocomplete="username"></div>
    <div class="field"><label>密碼（6 位數字）</label><input id="authPwd" type="password" inputmode="numeric" pattern="[0-9]*" maxlength="6" placeholder="例如 123456" autocomplete="current-password"></div>
    <div class="row">
      <button id="authLogin">登入</button>
      <button id="btnRegister">註冊</button>
      <button id="btnForgot">忘記密碼</button>
      <button id="btnReset">重設密碼</button>
    </div>
    <div id="authMsg" class="muted"></div>

    <div id="regBox" hidden class="card" style="margin-top:10px">
      <strong>註冊</strong>
      <div class="field"><input id="regEmail" type="email" placeholder="Email"></div>
      <div class="field"><input id="regPwd" type="password" inputmode="numeric" pattern="[0-9]*" maxlength="6" placeholder="密碼（6 位數字）"></div>
      <div class="row"><button id="doRegister">建立帳號</button><span id="regMsg" class="muted"></span></div>
    </div>

    <div id="forgotBox" hidden class="card" style="margin-top:10px">
      <strong>忘記密碼</strong>
      <div class="field"><input id="forgotEmail" type="email" placeholder="註冊 Email"></div>
      <div class="row"><button id="sendCode">寄送驗證碼</button><span id="forgotMsg" class="muted"></span></div>
    </div>

    <div id="resetBox" hidden class="card" style="margin-top:10px">
      <strong>重設密碼</strong>
      <div class="field"><input id="resetEmail" type="email" placeholder="註冊 Email"></div>
      <div class="field"><input id="resetCode" type="text" inputmode="numeric" pattern="[0-9]*" maxlength="6" placeholder="6 碼驗證碼"></div>
      <div class="field"><input id="resetPwd" type="password" inputmode="numeric" pattern="[0-9]*" maxlength="6" placeholder="新密碼（6 位數字）"></div>
      <div class="row"><button id="doReset">確認重設</button><span id="resetMsg" class="muted"></span></div>
    </div>
  </div>
</div>

<main>
  <!-- 標題區域 -->
  <div class="fade-in">
    <h1>📝 簽約儀式管理系統</h1>
    <div class="row" style="justify-content:center;margin-bottom:24px;">
      <div id="who" class="muted"></div>
      <button id="logout" class="danger">🚪 登出</button>
    </div>
  </div>

  <!-- 控制面板 -->
  <div class="control-panel fade-in">
    <div class="row" style="justify-content:space-between;align-items:center;margin-bottom:16px;">
      <h2 style="margin:0;color:var(--primary);">🎯 房間管理</h2>
      <div class="status-indicator status-online">
        <div class="status-dot"></div>
        <span>系統運行中</span>
      </div>
    </div>
    
    <div class="row">
      <input id="title" placeholder="🏷️ 房間標題 (預設: 簽約儀式)" style="flex:1;min-width:200px">
      <input id="w" type="number" placeholder="寬度 1000" style="width:120px">
      <input id="h" type="number" placeholder="高度 1000" style="width:120px">
      <button id="createEvent" class="primary">✨ 建立房間</button>
      <button id="refreshEvents">🔄 更新清單</button>
    </div>
    
    <div id="adminOps" class="row" style="margin-top:12px;" hidden>
      <button id="toggleAll" class="primary">👁️ 顯示全部房間</button>
      <button id="clearAllUsers" class="danger">🗑️ 清除所有人的歷史</button>
    </div>
  </div>

  <!-- 歷史房間 -->
  <div class="card fade-in" style="margin-bottom:24px;">
    <div class="row" style="justify-content:space-between;align-items:center;">
      <h3 style="margin:0;color:var(--primary);">📚 歷史房間</h3>
      <button id="clearMine" class="danger">🧹 清除我的歷史</button>
    </div>
    <div id="events" class="list" style="margin-top:16px;"></div>
  </div>

  <!-- 簽名區域控制 -->
  <div class="signature-controls fade-in">
    <div class="row" style="justify-content:space-between;align-items:center;margin-bottom:16px;">
      <h3 style="margin:0;color:var(--primary);">🎨 簽名區域設定</h3>
      <div id="eventInfo" class="muted">尚未選擇房間</div>
    </div>
    
    <!-- 快速設定 -->
    <div class="row" style="margin-bottom:16px;">
      <label style="display:flex;align-items:center;gap:8px;">
        <span>甲方欄位數</span>
        <input id="countA" type="number" value="1" min="0" max="8" style="width:80px">
      </label>
      <label style="display:flex;align-items:center;gap:8px;">
        <span>乙方欄位數</span>
        <input id="countB" type="number" value="1" min="0" max="8" style="width:80px">
      </label>
      <button id="applyCounts" class="primary">🎯 自動排版</button>
      <button id="resetPositions" class="danger">🔄 重置位置</button>
    </div>

    <!-- 精確位置控制 -->
    <div id="positionControls" style="display:none;">
      <h4 style="margin:0 0 12px 0;color:var(--primary);">📍 精確位置調整</h4>
      <div class="position-controls">
        <div class="position-group">
          <h4>甲方位置</h4>
          <div class="position-inputs">
            <input id="aX" type="number" placeholder="X座標">
            <input id="aY" type="number" placeholder="Y座標">
            <input id="aW" type="number" placeholder="寬度">
            <input id="aH" type="number" placeholder="高度">
          </div>
        </div>
        <div class="position-group">
          <h4>乙方位置</h4>
          <div class="position-inputs">
            <input id="bX" type="number" placeholder="X座標">
            <input id="bY" type="number" placeholder="Y座標">
            <input id="bW" type="number" placeholder="寬度">
            <input id="bH" type="number" placeholder="高度">
          </div>
        </div>
      </div>
      <div class="row" style="margin-top:12px;">
        <button id="applyPositions" class="primary">✅ 套用位置</button>
        <button id="cancelPositions">❌ 取消</button>
      </div>
    </div>
  </div>

  <!-- QR 與畫布 -->
  <div class="card fade-in">
    <div class="row" style="justify-content:space-between;align-items:center;margin-bottom:16px;">
      <h3 style="margin:0;color:var(--primary);">📱 簽名 QR 碼</h3>
      <div class="row">
        <button id="downloadQR" class="primary">💾 下載 QR</button>
        <button id="printQR" class="primary">🖨️ 列印 QR</button>
      </div>
    </div>
    
    <div class="row">
      <div style="flex:1;min-width:300px">
        <div class="muted" style="margin:4px 0 12px;font-weight:600;">👤 甲方簽名區域</div>
        <div id="qrA" class="qrGrid"></div>
      </div>
      <div style="flex:1;min-width:300px">
        <div class="muted" style="margin:4px 0 12px;font-weight:600;">👥 乙方簽名區域</div>
        <div id="qrB" class="qrGrid"></div>
      </div>
    </div>
    
    <div style="margin-top:24px;">
      <div class="row" style="justify-content:space-between;align-items:center;margin-bottom:12px;">
        <h3 style="margin:0;color:var(--primary);">🖼️ 簽名畫布預覽</h3>
        <div class="row">
          <button id="zoomIn" class="primary">🔍+ 放大</button>
          <button id="zoomOut" class="primary">🔍- 縮小</button>
          <button id="resetZoom" class="primary">🎯 重置</button>
        </div>
      </div>
      
      <!-- 背景圖片控制 -->
      <div class="background-controls">
        <h4 style="margin:0 0 12px 0;color:var(--primary);">🖼️ 背景圖片設定</h4>
        <div class="row">
          <label class="file-upload">
            📁 選擇背景圖片
            <input id="backgroundUpload" type="file" accept="image/*" hidden>
          </label>
          <button id="clearBackground" class="danger">🗑️ 清除背景</button>
          <div class="background-preview" id="backgroundPreview"></div>
        </div>
        <div class="muted" style="margin-top:8px;font-size:12px;">
          支援 JPG、PNG、GIF 格式，建議尺寸與畫布相同
        </div>
      </div>
      
      <div style="position:relative;display:inline-block;">
        <canvas id="stage" width="1000" height="1000"></canvas>
        <div id="dragOverlay" style="position:absolute;top:0;left:0;pointer-events:none;"></div>
      </div>
    </div>
  </div>
</main>

<script src="admin.js"></script>
</body>
</html>
