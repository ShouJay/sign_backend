<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8"/>
  <title>簽名端</title>
  <script src="/socket.io/socket.io.js"></script>
  <style>
    body { margin:0; }
    canvas { touch-action:none; width:100vw; height:100vh; display:block; }
    #toolbar { position:fixed; top:0; left:0; background:#fff; padding:5px; z-index:10; }
  </style>
</head>
<body>
  <div id="toolbar">
    <input type="color" id="color" value="#000000"/>
    <input type="range" id="size" min="2" max="20" value="4"/>
    <button id="clear">清除</button>
  </div>
  <canvas id="pad"></canvas>

<script>
const pad = document.getElementById('pad');
const ctx = pad.getContext('2d');
let drawing=false,last=null,points=[];
let socket, eventId=new URL(location.href).searchParams.get('eventId');

function resize(){
  pad.width=window.innerWidth; pad.height=window.innerHeight;
  ctx.lineCap='round'; ctx.lineJoin='round';
}
resize(); window.onresize=resize;

socket = io();
if(eventId) socket.emit('join:event',{eventId,role:'signer'});

pad.addEventListener('pointerdown',e=>{
  drawing=true; last=[e.offsetX,e.offsetY]; points=[last];
});
pad.addEventListener('pointermove',e=>{
  if(!drawing) return;
  const pt=[e.offsetX,e.offsetY];
  ctx.strokeStyle=document.getElementById('color').value;
  ctx.lineWidth=parseInt(document.getElementById('size').value,10);
  ctx.beginPath(); ctx.moveTo(last[0],last[1]); ctx.lineTo(pt[0],pt[1]); ctx.stroke();
  points.push(pt); last=pt;
});
pad.addEventListener('pointerup',()=>{
  drawing=false;
  if(eventId && points.length>1){
    socket.emit('stroke',{eventId,points,size:parseInt(document.getElementById('size').value,10),color:document.getElementById('color').value});
  }
  points=[];
});

document.getElementById('clear').onclick=()=>{
  ctx.clearRect(0,0,pad.width,pad.height);
  if(eventId) socket.emit('clear',{eventId});
};
</script>
</body>
</html>